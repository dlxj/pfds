# 演習問題 8.5

>  定理8.1を証明せよ

不変条件: $D(i)\le \min(ci+i, cs+1-t)$  ただし $s=\min(|f|,|r|), t=\max(|f|,|r|)$

- 回転を起こさない `cons`

  - 先頭側ストリームに要素を追加、 $|f|$ が 1 増える
    - $|f|<|r|$ のとき、$cs+1-t =c |f|+1-|r|$ も 1 増えるので問題なし
    - $|f|\ge|r|$ のとき、$cs+1-t = c|r|+1-|f|$ は 1 減る
      - 不変条件を守るには、キューの末尾の負債を返済し、全ての後続の累積負債を 1 ずつ減らす

- 回転を起こさない `tail`

  - 先頭側ストリームから要素を削除、$|f|$ が 1 減る
    - $|f|>|r|$ のとき、$cs+1-t = c|r|+1-|f|$ は 1 増えるので問題なし
    - $|f|\le|r|$ のとき、$cs+1-t = c|f|+1-|r|$ は c 減る
      - 不変条件を守るには、キューの先頭 c 個の負債を返済し、全ての後続の累積負債を c ずつ減らす

- 回転を引き起こす `cons` と `tail`

  - $|f|>c|r|+1$ のとき、$|f|=cm+2, |r|=m$ とすると、

    - `r' = r ++ reverse (drop i f)` なので（$i = \frac{|f|+|r|}{2}=\frac{(c+1)m}{2}+1>m+1$）
    - `++` のために $|r| = m$ の負債: 末尾 $m$ ノードに 1 ずつ負わせる
    - `reverse` のために $\frac{(c+1)m}{2}+1$ の負債: 末尾から $m+1$ 番目のノードにまとめて負わせる
    - 負債は次を満たすように分散される

    $$
    d(j) =
    \begin{cases}
    1 & j<m\ のとき \\
    \frac{(c+1)m}{2}+1 & j=m\ のとき \\
    0 & j>m\ のとき
    \end{cases}
    \quad
    かつ
    \quad
    D(j) = \begin{cases}
    j+1 & j<m\ のとき \\
    \frac{(c+3)m}{2}+1 & j\ge m\ のとき
    \end{cases}
    $$

    - あとは、ノード 0 の負債を返済すれば不変条件を守ることができる 

  - $|r|>c|f|+1$ のとき

    - 略