# 練習問題 3.8 

サイズ $n$ の赤黒木におけるノードの最大の深さがたかだか $2\lfloor {\rm log}_2 (n+1) \rfloor$ であることを示す

**対偶:** ノードの最大の深さが $2\lfloor {\rm log}_2 (n+1) \rfloor$ より大きいとき、サイズ $n$ の赤黒木を構成することはできない

**不変条件 1.**  赤いノードは赤い子ノード

**不変条件 2.**  根から空ノードへの経路は全て、同じ数の黒いノードを持つ

→ 最長の経路が最短の経路のたかだか 2 倍であることが保証される



### 1. $n = 2^k-1\ (k\in\mathbb{Z}_0)$ と表せるとき

$$
2\lfloor {\rm log}_2 (n+1) \rfloor = 2\lfloor {\rm log}_2 (2^k-1+1)\rfloor =2 \lfloor k\rfloor =2 k
$$

なので、最長深さ $2k+1$ の赤黒木を構成することを考える。

深さ最長の部分は $k$ 個の赤ノードと $k+1$ 個の黒ノード（そのうち $1$ つは葉ノード）で構成されるため、最短部分は $k$ 個の赤ノードを除いた深さ $k$ となる。（根と葉は黒なので、赤ノードは深さの半分未満のノード数しか存在しない）

この赤黒木では全てのパスが深さ $k$ 以上である。高さ $k$ の完全二分木の要素数は $2^k-1=n\quad (n\ge 0)$ であり、この赤黒木では少なくとも1つのパスが $2k+1$ のパスを持つため、要素数は $n$ を超える。

そのため、サイズ $n$ の赤黒木を構成することはできない。



### 2. $n\ne 2^k-1\ (k\in\mathbb{Z}_0,\ k>1)$ と表せるとき

$$
2k-2 < 2{\rm log}_2 (2^{k-1}+1) \leq 2\lfloor {\rm log}_2 (n+1) \rfloor <2k\quad (2^{k-1}\le n\lt 2^k-1)
$$

なので、最長深さ $2k$ の赤黒木を構成することを考える。

深さ最長の部分は $k-1$ 個の赤ノードと $k+1$ 個の黒ノード（そのうち $1$ つは葉ノード）で構成されるため、最短部分は深さ $k$ となる。

あとは1. の場合と同様にして、サイズ $n$ の赤黒木を構成することはできないことを示すことができる。

